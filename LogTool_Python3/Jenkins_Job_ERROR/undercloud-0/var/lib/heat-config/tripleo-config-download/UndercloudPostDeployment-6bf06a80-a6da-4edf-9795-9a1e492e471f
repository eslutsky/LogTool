[{"config": "#!/bin/bash\nset -eux\n\nHOMEDIR=\"$homedir\"\nUSERNAME=`ls -ld $HOMEDIR | awk {'print $3'}`\nGROUPNAME=`ls -ld $HOMEDIR | awk {'print $4'}`\n\n# WRITE OUT STACKRC\ntouch $HOMEDIR/stackrc\nchmod 0600 $HOMEDIR/stackrc\n\ncat > $HOMEDIR/stackrc <<-EOF_CAT\n# Clear any old environment that may conflict.\nfor key in \\$( set | awk -F= '/^OS_/ {print \\$1}' ); do unset \"\\${key}\" ; done\n\nexport OS_AUTH_TYPE=password\nexport OS_PASSWORD=$admin_password\nexport OS_AUTH_URL=$auth_url\nexport OS_USERNAME=admin\nexport OS_PROJECT_NAME=admin\nexport COMPUTE_API_VERSION=1.1\nexport NOVA_VERSION=1.1\nexport OS_NO_CACHE=True\nexport OS_CLOUDNAME=undercloud\nexport OS_IDENTITY_API_VERSION='3'\nexport OS_PROJECT_DOMAIN_NAME='Default'\nexport OS_USER_DOMAIN_NAME='Default'\nEOF_CAT\n\nif [ -n \"$internal_tls_ca_file\" ]; then\n    cat >> $HOMEDIR/stackrc <<-EOF_CAT\nexport OS_CACERT=\"$internal_tls_ca_file\"\nEOF_CAT\nfi\n\ncat >> $HOMEDIR/stackrc <<-\"EOF_CAT\"\n# Add OS_CLOUDNAME to PS1\nif [ -z \"${CLOUDPROMPT_ENABLED:-}\" ]; then\n    export PS1=${PS1:-\"\"}\n    export PS1=\\${OS_CLOUDNAME:+\"(\\$OS_CLOUDNAME)\"}\\ $PS1\n    export CLOUDPROMPT_ENABLED=1\nfi\nEOF_CAT\n\nif [ -n \"$ssl_certificate\" ]; then\n    cat >> $HOMEDIR/stackrc <<-EOF_CAT\nexport PYTHONWARNINGS=\"ignore:Certificate has no, ignore:A true SSLContext object is not available\"\nEOF_CAT\nfi\n\nchown \"$USERNAME:$GROUPNAME\" \"$HOMEDIR/stackrc\"\n\n. $HOMEDIR/stackrc\n\nif [ ! -f $HOMEDIR/.ssh/authorized_keys ]; then\n    sudo mkdir -p $HOMEDIR/.ssh\n    sudo chmod 700 $HOMEDIR/.ssh/\n    sudo touch $HOMEDIR/.ssh/authorized_keys\n    sudo chmod 600 $HOMEDIR/.ssh/authorized_keys\nfi\n\nif [ ! -f $HOMEDIR/.ssh/id_rsa ]; then\n    ssh-keygen -b 1024 -N '' -f $HOMEDIR/.ssh/id_rsa\nfi\n\nif ! grep \"$(cat $HOMEDIR/.ssh/id_rsa.pub)\" $HOMEDIR/.ssh/authorized_keys; then\n    cat $HOMEDIR/.ssh/id_rsa.pub >> $HOMEDIR/.ssh/authorized_keys\nfi\nchown -R \"$USERNAME:$GROUPNAME\" \"$HOMEDIR/.ssh\"\n", "creation_time": "2020-03-04T03:03:05Z", "deployment_name": "UndercloudPostDeployment", "group": "script", "id": "6bf06a80-a6da-4edf-9795-9a1e492e471f", "inputs": [{"name": "deploy_identifier", "description": null, "type": "String", "value": ""}, {"name": "admin_password", "description": null, "type": "String", "value": "Yq7PMRlKwa8QQ6XUT1kAJEUZz"}, {"name": "auth_url", "description": null, "type": "String", "value": "https://192.168.24.2:13000"}, {"name": "internal_tls_ca_file", "description": null, "type": "String", "value": ""}, {"name": "cloud_name", "description": null, "type": "String", "value": "undercloud"}, {"name": "ssl_certificate", "description": "None", "type": "String", "value": "-----BEGIN CERTIFICATE-----\nMIIDpTCCAo2gAwIBAgIUXG6ocqFnb11vwRF84uihsKV4nyQwDQYJKoZIhvcNAQEL\nBQAwYjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk5DMRAwDgYDVQQHDAdSYWxlaWdo\nMRAwDgYDVQQKDAdSZWQgSEF0MQswCQYDVQQLDAJRRTEVMBMGA1UEAwwMMTkyLjE2\nOC4yNC4yMB4XDTIwMDMwNDAyNTgyOFoXDTIxMDMwNDAyNTgyOFowYjELMAkGA1UE\nBhMCVVMxCzAJBgNVBAgMAk5DMRAwDgYDVQQHDAdSYWxlaWdoMRAwDgYDVQQKDAdS\nZWQgSEF0MQswCQYDVQQLDAJRRTEVMBMGA1UEAwwMMTkyLjE2OC4yNC4yMIIBIjAN\nBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1ANFQYYrEd+0b6RpEDMQbJ7PVxZ/\ngjzbcLbIrs+6KbntZ5YxXHHsi2RdZ3QQ15YyQiT5UHq6I29/7DqSGJGhnC1TwEzy\nEnYMn1Cy4Z671Cs/7kmWsU+0Bq2ZZm7sszjK4JQJoh7cjxp2Ec9Exr6p/3e1DGT9\nF7Vuen7cmAky2KcLscStzE0JyzzymVckHkbLybJG1FC4XQ4rPqh9jQuWzRfudo+l\nzHGVqxh13uucCu+PFImTKp38BwxEhvgJcajwuvF4UCf/2pHVLpVGH70qKoc3GNel\n1wjDmbsL5G3+ZN+yWrL7HuKrNv0l864XXP/GzYQ54c5ZtnIsPINKjblFNwIDAQAB\no1MwUTAdBgNVHQ4EFgQUOxlToSUQunTNn5U0KSL3ctDAWDIwHwYDVR0jBBgwFoAU\nOxlToSUQunTNn5U0KSL3ctDAWDIwDwYDVR0TAQH/BAUwAwEB/zANBgkqhkiG9w0B\nAQsFAAOCAQEAx0igafMxzf2+jNevToDb5fO7AYacsMJvSe5DcBeSxI/pwvRXRcHR\nSUhXrLnPNTbdiBo4dRxmJCvrKqYUrFW0EQ8AxcKjMR8l6Hl2pjKszvWc/+JZL1XN\n17UlSdlnm4WuY7sKXZrB8v7uowd3kKTZvVotMmmRkhTlU5MkNR6zjH3tQd1c8IBz\nlxXtoWHF6ghgCl5POE9Wx0TyV+y5qBJzQ5CpQRgGKgS8SZf28Pldkzoq/6gDyxDZ\nN9Z53O7IxK/E7D5Mi6qYQ1pYBe1bbNNeIZwVAWLEUFzSZ3pbDOMfGrmq+cCVb+cr\nlSqwb36O9T1Q+Bse6/v++mAzwfb35DkVnA==\n-----END CERTIFICATE-----"}, {"name": "homedir", "description": "None", "type": "String", "value": "/home/stack"}, {"name": "deploy_server_id", "description": "ID of the server being deployed to", "type": "String", "value": "1e6ea2e1-c44d-4e40-b09e-10d94ca508c0"}, {"name": "deploy_action", "description": "Name of the current action being deployed", "type": "String", "value": "CREATE"}, {"name": "deploy_stack_id", "description": "ID of the stack this deployment belongs to", "type": "String", "value": "undercloud-AllNodesDeploySteps-zuuy36jjpozg-UndercloudExtraConfigPost-chemsis6sbys-UndercloudPostDeployment-pyskzxsz3umy-0-z4t24oz2d525/80124df7-71ff-4ef4-9e9e-9b9c61dfa8be"}, {"name": "deploy_resource_name", "description": "Name of this deployment resource in the stack", "type": "String", "value": "TripleOSoftwareDeployment"}, {"name": "deploy_signal_transport", "description": "How the server should signal to heat with the deployment output values.", "type": "String", "value": "NO_SIGNAL"}], "name": "deployment_resource", "options": {}, "outputs": null}]